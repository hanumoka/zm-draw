# zm-draw 세션 상태

> 최종 업데이트: 2026-01-29 (Phase 11 Yjs 협업 통합 중)

---

## 현재 상태

**Phase**: **Phase 11 진행 중** 🔄 (Yjs 실시간 협업)
**목표**: FigJam 스타일 실시간 협업 화이트보드
**진행률**: Phase 1-10 완료 / Phase 11 진행 중 / Phase 12-17 예정

### 마지막 작업 (2026-01-29)

- **Phase 11: Yjs 실시간 협업** 🔄 진행 중
  - **Yjs 패키지 설치** ✅
    - `yjs`: CRDT 기반 실시간 동기화
    - `y-websocket`: WebSocket 프로바이더
    - `y-indexeddb`: 오프라인 지원
  - **collaborationStore.ts** ✅ 생성
    - `Y.Doc` 관리 (shapes, connectors Y.Map)
    - WebSocket 프로바이더 연결
    - IndexedDB 오프라인 지원
    - UserPresence (cursor, selection, viewport 공유)
    - Awareness API 통합
  - **useCollaboration.ts** ✅ 생성
    - Yjs ↔ 로컬 상태 양방향 동기화
    - 원격 변경 감지 및 적용
    - 커서/선택/뷰포트 업데이트 함수
  - **DrawCanvas 통합** ✅ 완료
    - 협업 props 추가 (collaborationEnabled, roomId, serverUrl, userName)
    - useCollaboration 훅 연결
    - 원격 커서 렌더링 (Konva 레이어)
    - 연결 상태 UI (상단 우측)
    - 원격 사용자 아바타 표시
  - **빌드** ✅ 성공 (141.08 KB)

### 남은 작업 (Phase 11)

- [ ] 11.3 원격 선택 하이라이트 표시
- [ ] 11.4 WebSocket 서버 설정 가이드
- [ ] 11.5 오프라인 모드 테스트
- [ ] 11.6 충돌 해결 테스트

### 이전 작업 (2026-01-29)

- **Phase 10: 스탬프 기능** ✅ 완료
  - 스탬프 도형 (8가지 이모지)
  - 툴바 UI + 팝오버 선택기
  - 숫자 1-8 단축키

- **Phase 9: 이미지 기능** ✅ 완료
  - 이미지 도형 (드래그앤드롭, 클립보드)
  - 툴바 버튼 (I 단축키)
  - SVG export 지원

### 개발 서버

- **상태**: 정상 동작
- **포트**: 3200
- **URL**: http://localhost:3200

### Git 상태

- **브랜치**: main
- **원격**: origin/main

---

## Phase 11 협업 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                      DrawCanvas                              │
│  ┌─────────────┐     ┌──────────────────┐                   │
│  │   shapes    │ ←→  │ useCollaboration │                   │
│  │ connectors  │     │   (hook)         │                   │
│  └─────────────┘     └────────┬─────────┘                   │
│                                │                            │
│                      ┌────────▼─────────┐                   │
│                      │ collaborationStore│                   │
│                      │   (Zustand)       │                   │
│                      └────────┬─────────┘                   │
│                                │                            │
│           ┌────────────────────┼────────────────────┐       │
│           │                    │                    │       │
│    ┌──────▼──────┐     ┌──────▼──────┐     ┌──────▼──────┐ │
│    │   Y.Doc     │     │  Awareness  │     │  IndexedDB  │ │
│    │  Y.Map      │     │   (cursors) │     │ (offline)   │ │
│    └──────┬──────┘     └──────┬──────┘     └─────────────┘ │
│           │                    │                            │
│           └────────┬───────────┘                            │
│                    │                                        │
│            ┌───────▼───────┐                                │
│            │ WebSocketProvider │ ← y-websocket              │
│            └───────┬───────┘                                │
└────────────────────┼────────────────────────────────────────┘
                     │
                     ▼
            ┌─────────────────┐
            │  Yjs Server     │ (별도 서버 필요)
            │  (y-websocket)  │
            └─────────────────┘
```

### 연결 상태 UI

```
┌───────────────────────────────────────┐
│  ● 2 online  [A] [B]                  │  ← 상단 우측
└───────────────────────────────────────┘
  │     │        │   │
  │     │        │   └─ 원격 사용자 아바타
  │     │        └─ 로컬 사용자 아바타
  │     └─ 연결된 사용자 수
  └─ 연결 상태 (녹색/주황/회색)
```

### 원격 커서 렌더링

- Konva.Layer에 원격 사용자 커서 표시
- 사용자 색상 + 이름 라벨
- 캔버스 좌표로 변환

---

## 구현 완료된 기능 (Phase 11 기준)

| 기능 | 상태 | Figma 대비 |
|------|------|-----------|
| 도형 생성 (Rect, Ellipse, Diamond) | ✅ 완료 | 30% |
| 스티키 노트 | ✅ 완료 | 80% |
| 펜/마커/하이라이터 | ✅ 완료 | 70% |
| 이미지 삽입 | ✅ 완료 | 80% |
| 스탬프/이모지 | ✅ 완료 | 90% |
| **실시간 협업** | 🔄 진행 중 | 60% |
| 도형 선택/삭제/이동 | ✅ 완료 | 100% |
| 리사이즈/회전 | ✅ 완료 | 100% |
| 텍스트 편집 | ✅ 완료 | 50% |
| 커넥터/화살표 | ✅ 기본+고급 | 60% |
| 줌/팬 | ✅ 완료 | 100% |
| Undo/Redo | ✅ 완료 | 100% |
| Save/Load (JSON) | ✅ 완료 | 100% |
| Copy/Paste/Duplicate | ✅ 완료 | 100% |
| 화살표 키 이동 | ✅ 완료 | 100% |
| 정렬/분배/그룹핑 | ✅ 완료 | 80% |
| 레이어 관리 | ✅ 완료 | 70% |
| PNG/SVG Export | ✅ 완료 | 80% |
| 미니맵 | ✅ 완료 | 90% |

---

## 기술 결정사항

| 항목 | 현재 | 목표 | 상태 |
|------|------|-----|------|
| 상태 관리 | Zustand | Zustand | ✅ 완료 |
| UI 컴포넌트 | Radix UI | Radix UI | ✅ 완료 |
| 컬러 피커 | react-colorful | react-colorful | ✅ 완료 |
| Canvas 라이브러리 | Konva 10.0.0 | Konva 10.x | ✅ 완료 |
| **실시간 협업** | **Yjs** | **Yjs** | 🔄 **통합 중** |

---

## 개발 환경 확인 명령어

```bash
# 개발 서버 시작
cd C:/Users/amagr/projects/zm-draw && pnpm dev

# 빌드 확인
pnpm build

# 타입 체크
pnpm type-check
```

---

## 참고 문서

- **전체 진행상황**: `docs/PROGRESS.md`
- **FigJam 스타일 로드맵**: `docs/FIGJAM-ROADMAP.md`
- **프로젝트 구조**: `docs/PROJECT.md`

---

*다음 세션 시작 시 이 파일을 먼저 읽으세요.*
